angular.module("directive.selector",["ngAnimate"]).directive("dySelector",["$document",function($document){return{restrict:"E",replace:true,scope:{ngModel:"=",dyList:"=",mode:"@",objectHandle:"="},template:'<div class="dy-selector"><div class="dy-selector-value" ng-class="{\'dy-selector-able\':selectorAble}" ng-click="showList()"><span ng-if="ngModel.dyKey" ng-bind="ngModel.dyKey"></span><span ng-if="!ngModel.dyKey" ng-bind="ngModel"></span></div><span class="df df-down" ng-class="{\'rotate-up\':isShowList}"></span><div class="dy-selector-list" ng-show="selectorAble && isShowList"><div ng-hide="mode == \'simple\'"><input type="text" ng-model="keyWord"/><span class="df df-search-bold"></span></div><ul><li ng-repeat="item in dyList track by $index" ng-click="setItem(item)" ng-show="itemShow(item)"><span ng-if="item.dyKey" ng-bind="item.dyKey"></span><span ng-if="!item.dyKey" ng-bind="item"></span></li></ul></div></div>',link:function($scope,$element,$attr){if(!$scope.objectHandle){if($scope.dyList&&$scope.dyList.length>0){if(typeof $scope.dyList[0]=="object"){if(typeof $scope.dyList[0].dyKey=="undefined"||typeof $scope.dyList[0].dyVal=="undefined"){throw Error("对象格式不支持，请按照{dyKey : xx, dyVal : xx}格式传参")}}}}else{for(var i in $scope.dyList){$scope.dyList[i].dyKey=$scope.dyList[i][$scope.objectHandle.dyKey];$scope.dyList[i].dyVal=$scope.dyList[i][$scope.objectHandle.dyVal]}}if($attr.zIndex&&$attr.zIndex.length>0){$element.css({"z-index":$attr.zIndex})}if($attr.disabled!=""&&$attr.disabled!="disabled"){$scope.selectorAble=true}else{$scope.selectorAble=false}if(typeof $scope.multiple=="undefined"){$scope.multiple=false}$document.on("click",function(e){if(e.target!=$element[0]){isChild(e.target.parentElement)}});function isChild(e){if(e){if(e!=$element[0]){isChild(e.parentElement)}}else{$scope.isShowList=false;$scope.$apply()}}$scope.isShowList=false;$scope.keyWord="";$scope.setItem=function(item){$scope.ngModel=item;$scope.isShowList=false;$scope.keyWord=""};$scope.showList=function(){$scope.isShowList=!$scope.isShowList;$scope.keyWord=""};$scope.itemShow=function(item){if(typeof item=="object"){return item.dyKey.toUpperCase().indexOf($scope.keyWord.toUpperCase())!=-1}else{return item.toUpperCase().indexOf($scope.keyWord.toUpperCase())!=-1}}}}}]);